General
-------

Choice parameter
Name: TARGET_TEST
Choices:
eu.supersede.integration.api.adaptation.dashboard.proxies.test.AdaptationDashboardProxyTest
eu.supersede.integration.api.adaptation.dashboard.proxies.test.AdaptationDashboardResetTest
eu.supersede.integration.api.adaptation.proxies.test.AdaptationConfigurationProxyTest
eu.supersede.integration.api.adaptation.proxies.test.AdapterProxyTest
eu.supersede.integration.api.adaptation.proxies.test.ModelRepositoryProxyTest
eu.supersede.integration.api.datastore.proxies.test.FEDataStoreProxyTest
eu.supersede.integration.api.datastore.proxies.test.IFDataStoreProxyTest
eu.supersede.integration.api.dm.proxies.test.DMOptimizerProxyTest
eu.supersede.integration.api.dm.proxies.test.DecisionMakingSystemProxyTest
eu.supersede.integration.api.fe.test.FrontendAuthenticationTest
eu.supersede.integration.api.feedback.proxies.test.FeedbackOrchestratorProxyTest
eu.supersede.integration.api.feedback.proxies.test.FeedbackRepositoryProxyTest
eu.supersede.integration.api.mdm.proxies.test.MetadataManagementProxyTest
eu.supersede.integration.api.monitoring.proxies.test.AppStoreMonitorProxyTest
eu.supersede.integration.api.monitoring.proxies.test.ConfigurationFileHttpMonitorProxyTest
eu.supersede.integration.api.monitoring.proxies.test.GooglePlayMonitorProxyTest
eu.supersede.integration.api.monitoring.proxies.test.TwitterMonitorProxyTest
eu.supersede.integration.api.monitoring.proxies.test.DiskMonitorProxyTest
eu.supersede.integration.api.monitoring.proxies.test.HttpMonitorProxyTest
eu.supersede.integration.api.monitoring.proxies.test.MonitorManagerProxyTest
eu.supersede.integration.api.monitoring.proxies.test.MonitoringOrchestratorProxyTest
eu.supersede.integration.api.proxies.test.MailProxyTest
eu.supersede.integration.api.pubsub.test.AdaptationAlertPubSubTest
eu.supersede.integration.api.pubsub.test.AlertPubSubTest
eu.supersede.integration.api.pubsub.test.EvolutionAlertPubSubTest
eu.supersede.integration.api.pubsub.test.PubSubTest
eu.supersede.integration.api.pubsub.test.EvolutionAlertMessageListenerTest
eu.supersede.integration.api.replan.controller.proxies.test.ReplanControllerProxyTest
eu.supersede.integration.api.replan.optimizer.proxies.test.ReplanOptimizerProxyTest
eu.supersede.integration.api.replan.optimizer.proxies.test.ReplanOptimizerV2ProxyTest
eu.supersede.integration.api.security.test.IdentityManagerClientTest
eu.supersede.integration.api.security.test.IFAuthenticationManagerTest
eu.supersede.integration.api.tenants.test.IFTenantsManagerTest
eu.supersede.integration.federation.test.IFSupersedeFederationTest

String parameter
Name: DSPOT_AMPLIFIERS
Default_value: MethodAdd,MethodRemove,TestDataMutator,MethodGeneratorAmplifier,ReturnValueAmplifier,StringLiteralAmplifier,NumberLiteralAmplifier,BooleanLiteralAmplifier,CharLiteralAmplifier,AllLiteralAmplifiers,NullifierAmplifier
Description:
Options: MethodAdd,MethodRemove,TestDataMutator,MethodGeneratorAmplifier,ReturnValueAmplifier,StringLiteralAmplifier,NumberLiteralAmplifier,BooleanLiteralAmplifier,CharLiteralAmplifier,AllLiteralAmplifiers,NullifierAmplifier

Choice parameter
Name:DSPOT_SELECTOR
Choices:
PitMutantScoreSelector
JacocoCoverageSelector
TakeAllSelector
ChangeDetectorSelector

String parameter
Name: DSPOT_ITERACTIONS
Default value: 3

SCM
---

Repository: https://github.com/supersede-project/integration
Branch: */stamp-baseline

BUILD
-----

Execute shell:

#!/bin/bash -xe

#Configure Maven
export MAVEN_HOME=/var/jenkins_home/tools/hudson.tasks.Maven_MavenInstallation/Maven_3.6.0
export PATH=$PATH:$MAVEN_HOME/bin

#NOTE: Copy /var/jenkins_home/settings.xml into /roo/.m2 folder of Jenkins container
cd IF/API/eu.supersede.if.api
mvn clean package -DskipTests

#Time out:
TIMEOUT=30000

#Selectors: PitMutantScoreSelector,JacocoCoverageSelector,TakeAllSelector,ChangeDetectorSelector
#DSPOT_SELECTOR=JacocoCoverageSelector

#Amplifiers: MethodAdd,MethodRemove,TestDataMutator,MethodGeneratorAmplifier,ReturnValueAmplifier,StringLiteralAmplifier,NumberLiteralAmplifier,BooleanLiteralAmplifier,CharLiteralAmplifier,AllLiteralAmplifiers,NullifierAmplifier,None
#AllLiteralAmplifiers,MethodGeneratorAmplifier,ReturnValueAmplifier,NullifierAmplifier
#DSPOT_AMPLIFIERS=MethodAdd,MethodRemove,TestDataMutator,MethodGeneratorAmplifier,ReturnValueAmplifier,StringLiteralAmplifier,NumberLiteralAmplifier,BooleanLiteralAmplifier,CharLiteralAmplifier,AllLiteralAmplifiers,NullifierAmplifier

#Iterations (default=3):
#DSPOT_ITERACTIONS=3

#Target Test:
#TARGET_TEST=eu.supersede.integration.api.adaptation.dashboard.proxies.test.AdaptationDashboardProxyTest

#Number of amplified tests (default=200)
MAX_TEST_AMPLIFIED=200

#Budgetizer (RandomBudgetizer | TextualDistanceBudgetizer | SimpleBudgetizer>)
BUGETIZER=RandomBudgetizer

DSPOT_OPTS="-Diteration=$DSPOT_ITERACTIONS -Dtest=$TARGET_TEST -Damplifiers=$DSPOT_AMPLIFIERS -Dtest-criterion=$DSPOT_SELECTOR -DtimeOut=$TIMEOUT -Dmax-test-amplified=$MAX_TEST_AMPLIFIED -Dbudgetizer=$BUGETIZER -Dclean -Dverbose"

echo "DSpot configuration: " $DSPOT_OPTS
DSPOT_PROPERTIES="./dspot.properties"

#mvn help:evaluate -Dexpression=settings.localRepository | grep -v '\[INFO\]'
DSPOT_OUT=./dspot-out/
DSPOT_AMPLIFIERS_PATH=${DSPOT_AMPLIFIERS//,/-}
RESULTS_DIR=/var/jenkins_home/workspace/dspot-usecases-output/atos/supersede/IF/DSpot
RESULTS_DIR=$RESULTS_DIR/$DSPOT_SELECTOR/$DSPOT_AMPLIFIERS_PATH/`date '+%Y%m%d%H%M'`
mkdir -p $RESULTS_DIR
filename=$RESULTS_DIR/dspot.cmd

echo "Starting DSpot: reporting in file" + $filename
echo "Started DSpot: `date`" > $filename
echo "DSpot CLI configuration: " $DSPOT_OPTS >> $filename
echo "DSpot properties file: " $DSPOT_PROPERTIES >> $filename


#NOTE: Copy /var/jenkins_home/settings.xml into /root/.m2 folder of Jenkins container
mvn -f pom_dspot.xml eu.stamp-project:dspot-maven:amplify-unit-tests -Dpath-to-properties=$DSPOT_PROPERTIES $DSPOT_OPTS

#Storing DSpot execution in dspot-usecases-output
cp -r $DSPOT_OUT $RESULTS_DIR
cp $DSPOT_PROPERTIES $RESULTS_DIR

cd $RESULTS_DIR
git checkout master
git add *
git commit -m "DSpot execution results for amplification of test class(es): $TARGET_TEST"

Post-build actions
------------------

STAMP Dspot reports
Output directory: IF/API/eu.supersede.if.api/dspot-out




